\documentclass[11pt]{article}
\usepackage{amsmath}
\usepackage[a4paper,left=20mm,right=20mm,top=15mm,bottom=15mm]{geometry}
% \usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing}
% caption for subfigure
\usepackage{subcaption}
% indent for enumerate
\usepackage{enumitem}
\usepackage{multicol}
\usepackage{float}
% set vertical bar between 2cols
\setlength{\columnsep}{3em}
\setlength{\columnseprule}{0.4pt}
\usepackage{multirow,booktabs}
\usepackage[UTF8]{ctex}

\newcommand{\E}{\operatorname{E}}
\newcommand{\Cov}{\operatorname{Cov}}
\newcommand{\Var}{\operatorname{Var}}

\title{远期（期货）}
\author{杨弘毅}
\date{创建: 2020 年 3 月 4 日 \\修改: \today}

\begin{document}
\maketitle

\section{定价}
定价思路为远期（期货）合约价值$f_t$（合约本身价值），在签订时的有双方公平的原则（zero net market value at entry），应有$f_0=0$，即远期合约签订之时为价值0，进而得到远期（期货）价格$F_{t,T}$（远期价值为零的合理交割价格）。
\begin{itemize}
    \setlength{\itemsep}{0em}
    \item $S_t$：远期（期货）标的资产在t时刻的价格
    \item $K$：远期合约中的交割价格
    \item $f_t$：远期合约多头在t时刻的价值（合约价格）
    \item $F_{t,T}$：在t时刻时，到期时间为T的理论远期（期货）价格（标的物价格）
\end{itemize}

\subsection{风险中性定价}
在风险中性条件下，一份多头远期（期货）合约的价值$f_t$为:
\begin{align*}
    f_t &= M^Q \E^Q[S_T - K] \\
     &= e^{-r(T-t)} (\E^Q[S_T] - K) \\
     &= e^{-r(T-t)} ( S_t e^{r(T-t)}- K) \\
     &= S_t - Ke^{-r(T-t)}
\end{align*}

已知在t=0时，远期合约价值$f_0=0$，可确定在T时刻\textbf{合理交割价格K，即为合理远期价格$F_{0,T}$}。（在t=0时刻签订的到期日为T的远期合约，锁定远期价格）
\begin{align*}
    &f_0 = S_0 - Ke^{-rT} = 0 \\
    &\Rightarrow K = F_{0,T} = S_0 e^{rT} \\
    &\Rightarrow F_{t,T} = S_t e^{r(T-t)} \\
\end{align*}

\subsection{复制定价}
由于在到期日T时刻，有$F_{T,T}=S_T$，交割价格为K。即在T时刻，使用K单位现金，换取1单位现货$S_T$。构建组合A：由一单位远期合约多头$f_t$以及$Ke^{-r(T-t)}$构成。构建组合B：由一单位标的资产$S_t$构成，则有：
\begin{equation*}
    f_t + K e^{-r(T-t)} = S_t
\end{equation*}

由于在t=0时，合约价值$f_0=0$。$K=F_{0,T}=S_0e^{rT}$或有$F_{t,T}=S_te^{r(T-t)}$。由此可见此时期货价格$F_{t,T}$与现货价格$S_t$之间仅相差货币时间价值，这部分货币的时间价值可理解为持有成本。因购买期货不占用资金（假设保证金也会获得相应占用资金无风险利息），可获得相应资金的无风险利息。相反现货则需要占用资金，无法获得这部分的资金的无风险利息，应加上无风险利息作为其持有成本，使无论购买现货或期货成本相同（无套利）。可理解为如果购买期货或现货价格相同，那么所有人会直接购买期货，节约购买现货的持有成本。

\section{红利资产调整}
由于远期合约并不实际持有现货，所以如果资产在到期前有可预测的现金流（红利）无法获得，需要进行调整，使调整后资产变为无红利资产。

\subsection{已知红利}
远期合约到期之前，标的资产产生红利数额为$D$，其红利现值为$I_0$，则有$S_0-I_0$为剔除红利后，使其变为无红利资产。使用同上复制定价方法：
\begin{align*}
    &f_0 + Ke^{-rT} = S_0 - I_0 \\
    &f_0 = S_0 - I_0 - Ke^{-rT} = 0 \\ 
    &\Rightarrow K = F_{0,T} = (S_0 - I_0)e^{rT} \\
    &\Rightarrow F_{t,T} = (S_t - I_t)e^{r(T-t)}
\end{align*}
\begin{itemize}
    \item \textbf{正红利}：附息债券（Coupon Bond）、支付已知现金红利的股票。价格中包含红利，购买期货无法获得这部分收益，应从中扣除。
    \item \textbf{负红利}：黄金、白银，持有期间需要支付储藏成本。价格中不包含需要额外支付成本，可理解为如果黄金现货和期货价格相同，而黄金期货不需要储藏成本，那么所有人会直接购买黄金期货。即购买期货应加上这部分储藏成本。
\end{itemize}

\subsection{已知红利率}
在远期合约到期期间，标的资产会产生与现货价格成一定比率的红利。
\begin{align*}
    f_t &= e^{-r(T-t)} (S_0 e^{(r-q)(T-t)} - K) \\ 
    f_0 &= S_0 e^{-qT} - K e^{-rT} = 0 \\ 
    \Rightarrow \quad F_{0,T} &= e^{(r-q)T} \quad \text{或} \quad F_{t,T} = e^{(r-q)T}
\end{align*}
\begin{itemize}
    \item 外汇远期和期货：外汇发行国的无风险利率
    \item 股指期货：市场平均红利率或零，取决于股指计算方式
    \item 远期利率协议：本国的无风险利率
\end{itemize}

\section{期货与远期的关系}
当无风险利率恒定，且到期日交割价格等都相同时，远期价格与期货价格相同。当利率不断变化时，两者关系略有不同。其差异源于期货市场的保证金盯市制度（MTM：Mark-to-Market）。标的资产价格与利率有正相关关系时候，期货价格高于远期价格。即当期货价格上涨时，由于保证金盯市制度，可将多余的保证金取出，用同样上涨的无风险利率投资，此时期货价格应该高于远期价格。相反，当标的资产与利率呈现负相关关系时候，远期价格高于期货价格。

\section{$F_t$与$S_t$的关系}
在t时刻，期货价格$F_t$与现货价格$S_t$有如下关系，易知持仓成本即将现货持有到期货到期日的成本。由于期货为合约，并且只在规定到期日交割标的资产。在合约到期之前并不持有实际现货，因此无法获得持有现货的收益，并且持有现货到合约到期日的成本需计算在期货价格内，两者关系应有：
\begin{align*}
    F_{t,T} &= S_t + \textbf{净持仓成本（Net Cost of Carry）} \\
    &= S_t + \text{合约期限内成本（Carry Cost）} - \text{合约期限内收益（Carry Return）} \\
    &= S_t + \text{利息成本} + \text{储藏成本} - \text{红利收益} - \text{便利收益（商品期货）}
\end{align*}

由于在$t$时刻，如现货价格和持仓成本都为已知，则可确定期货价格。或已知期货的价格与持仓成本，则可确定现货价格（期货的价格发现功能）。两者关系为相对价格，而由无套利条件得到。在中国往往有现货价格$S_t$大于期货价格$F_t$（期货贴水，此时有正基差），由于现货做空机制不完善，很难融券，即使能融券成本也较高。使得套利投资者无法在现货被高估的情况下，卖出现货（卖出开仓）买进期货（因为只有持有现货才能卖出），造成两个市场的分割，无法达到一体化的预期。另外现货买卖需要交纳印花税，而期货不需要，且期货佣金往往低于现货。

\section{期货升水与贴水}
\textbf{基差}（Basis）指现货与期货价格之差（现货价格Spot price有时又被称为Cash price），即：
\begin{equation*}
    \text{基差} = \text{现货价格} - \text{期货价格}
\end{equation*}

对于期货（或远期）而言，\textbf{升水}（contango）或“Negative basis”，指当期货（或远期）的价格高于现货在到期日价格的期望。相反而言，如期货（或远期）价格低于现货在到期日价格的期望则成为\textbf{贴水}（backwardation）或称为“Postive basis”。

\section{$F_{t,T}$与$\E_t[S_T]$的关系}
两者相差风险溢价，即应有$F_{t,T}=\E[S_t]-\text{风险溢价}$。但由于风险溢价不确定，与期货与现货价格确定的关系相比不同，两者关系并不确定。在现实测度下，从现货角度出发，有$\E_t[S_T]=S_t e^{\mu(T-t)}$，其中$\mu$为到期收益率，为无风险收益率与风险溢酬之和。虽然现货价格可以从市场交易中得到，但期货市场交易成本较低，反应较为灵敏迅速，价格变化一般都由期货市场传递至现货市场。如果标的资产$S$\textbf{系统性风险为正，则要求有正的风险溢酬}（如未来期货价格$\E[S_T]=\E[F_T]$为2000，风险对持有者不利,要求500元的正的风险溢价，则买进价为1500元）使其到期收益率大于无风险收益率$\mu>r$。相反，如果标的资产$S$\textbf{系统性风险为负}（如VIX，系统性风险为负）。即标的资产能对冲风险，减少风险敞口，风险溢酬为负，减少收益，到期收益率小于无风险收益率$\mu<r$。

同样在现实测度下，从期货角度出发，因为购买期货无需占用资金（假设保证金可获得无风险收益），所以不要求无风险收益。仅要求对其承担的未来不确定性风险，有对应的风险补偿（仅赚取风险溢酬），即超额收益$\mu-r$，可以得到$\E_t[F_{T,T}] = F_{t,T} e^{(\mu-r)(T-t)}$。又因在期货到期日T时刻，有期货价格等于现货价格$F_{T,T} = S_T$，即在t时刻下也应有两者期望$\E_t[F_{T,T}] = \E_t[S_T]$。同样可得出$F_{t,T} = S_t e^{r(T-t)}$的结论，即：
\begin{equation*}
    S_t e^{\mu(T-t)} = \E_t[S_T] = \E_t[F_{T,T}] = F_{t,T} e^{(\mu-r)(T-t)}
\end{equation*}

\begin{figure}[ht!]  
% \centering 
  \begin{subfigure}[b]{0.4\textwidth}
    \begin{tikzpicture}   
      \draw[->,thick] (0,0) node[below] {$t$} -- (6,0) node[right] {时间};  
      \draw[->,thick] (0,0) -- (0,4) node[above] {价格};  
      \draw (4.5,0) node[below] {$T$} -- (4.5,4);
      \draw [draw opacity=0.6](0,0.5) node[left] {$S_t$} -- (4.5,2.5) node[right] {$\E_t[S_T]$}; 
      \draw [draw opacity=0.6](0,1.5) node[left] {$F_{t,T}$} -- (4.5,2.5);
      \draw [dashed, draw opacity=0.6] (0,2.5) -- (4.5,2.5);  
      \draw [decorate,decoration={brace,amplitude=5pt,mirror,raise=0.4em}] (0,0.5) -- (0,1.5) node[midway,right,xshift=1em]{\small 无风险利息};
      \draw [decorate,decoration={brace,amplitude=5pt,mirror,raise=0.4em}] (0,1.5) -- (0,2.5) node[midway,right,xshift=1em]{\small 正风险溢酬};
    \end{tikzpicture}
    \subcaption{正系统性风险} 
    \label{fig:M1}  
    \end{subfigure}
    \hspace*{2em}
    \begin{subfigure}[b]{0.4\textwidth}
    \begin{tikzpicture}  
      \draw[->,thick] (0,0) node[below] {$t$} -- (6,0) node[right] {时间};  
      \draw[->,thick] (0,0) -- (0,4) node[above] {价格};  
      \draw (4.5,0) node[below] {$T$} -- (4.5,4);
      \draw [draw opacity=0.6](0,0.5) node[left] {$S_t$} -- (4.5,2.5) node[right] {$\E_t[S_T]$}; 
      \draw [draw opacity=0.6](0,3.5) node[left] {$F_{t,T}$} -- (4.5,2.5);
      \draw [dashed, draw opacity=0.6] (0,2.5) -- (4.5,2.5);
      \draw [decorate,decoration={brace,amplitude=5pt,raise=1.5em}] (0,0.5) -- (0,3.5) node[midway,left,xshift=-2em]{\rotatebox{90}{\small 无风险利息}};
      \draw [decorate,decoration={brace,amplitude=5pt,mirror,raise=0.4em}] (0,2.5) -- (0,3.5) node[midway,right,xshift=1em]{\small 负风险溢酬};
    \end{tikzpicture}
    \subcaption{负系统性风险}
    \label{fig:M2}  
    \end{subfigure}
    % \caption{Interaction figures}
\end{figure}  


\section{套期保值}
\subsection{多头空头套期保值}
基差为被套期保值的现货价格H与用于套期保值的期货价格G之差$b = H - G$，未来到期时基差$b_1$的不确定性导致了\textbf{基差风险}。由于标的资产规模与期货合约标准数量之间的差异，导致了\textbf{数量风险}。基差风险、数量风险都可能使得套期保值策略无法对冲所有风险，即不完美的套期保值。

多头套期保值策略持有现货空头，担心未来价格上涨，买入期货锁定未来价格（期货多头）。相反，空头套期保值策略持有现货多头，担心未来价格下跌，卖出期货锁定未来卖出价格（期货空头）。当现货价格小于期货价格时，基差为负。假设$b_0=-10$，多头套保策略要有正收益要求基差变小，即$b_0>b_1$，$b_0=-10$，则有$b_1< -10$。\textbf{注意：此时虽然基差变小，但基差的绝对值在增大。}
\begin{table}[H]
\centering
\begin{tabular}{@{}cll@{}}
\toprule
\multicolumn{1}{l}{}           
& \multicolumn{1}{c}{\textbf{多头套期保值}} & \multicolumn{1}{c}{\textbf{空头套期保值}} \\
& 1单位现货H空头，1单位期货G多头 & 1单位现货H多头，1单位期货G空头 \\
\midrule
\textbf{收益} &$\quad(H_0 - H_1) + (G_1 - G_0)$ & $\quad(H_1 - H_0) + (G_0 - G_1)$ \\
& $=(H_0 - G_0) - (H_1 - G_1)$ & $=(H_1 - G_1) - (H_0 - G_0)$ \\
& $=b_0 - b_1$ & $=b_1 - b_0$ \\
\textbf{收益来源} & 基差变小 $b_0>b_1$ & 基差变大 $b_0<b_1$\\
\multirow{3}{*}{\textbf{收益条件}} & 1. 现货涨幅小于期货涨幅 & 1. 现货涨幅大于期货涨幅 \\
& 2. 现货跌幅大于期货跌幅 & 2. 现货跌幅小于期货跌幅 \\ 
& 3. 现货价格下跌而期货价格上涨 & 3. 现货价格上涨而期货价格下跌 \\
\bottomrule
\end{tabular}
\end{table}

\subsection{套保（金额）比率}
套期保值比率（Hedge Ratio），指现有头寸（金额）中，已有多少被套期保值（对冲）。假设当前有1000元的现货头寸，其中600元已使用期货进行套期保值，表示当前套期保值比率为0.6或60\%，同时表示还留有风险敞口40\%。\textbf{（每单位价格现货中有多少已被期货套期保值）}
\begin{equation*}
   \text{套期保值（金额）比率} = \frac{\text{套期保值资产头寸}}{\text{被套期保值资产头寸}}
\end{equation*}

\subsection{套保（数量）比率}
在已知了目前风险暴露情况，即套保（金额）比率之后，还希望了解在现有的现货头寸之下，需要多少数量的期货进行对冲。希望在期货到期时，最大化消除被套保资产价格变动所带来风险。此时要求被套保资产价格的变动对整个组合价值影响最小，进而转化为求解最小值问题。即对$\Delta H$求偏导，并使一阶条件$\partial\Delta\Pi / \partial \Delta H = 0$，求得\textbf{最优套期保值（数量）比率n}。因只关注最终期货到期时刻的套保比率，而不关注过程中的套保比率，所以此处使用的是$\Delta H$而非$\partial H$。

对于多头套期保值组合，有：
\begin{align*}
    &\Delta \Pi = n\Delta G - \Delta H \\
    &\Rightarrow\quad\frac{\partial (\Delta \Pi)}{\partial (\Delta H)}  = n\times \frac{\partial (\Delta G)}{\partial (\Delta H)} - 1 = 0 \\ 
    &\Rightarrow \quad n = \frac{\partial(\Delta H)}{\partial(\Delta G)} = \frac{\partial r_H \times H_0}{\partial r_G \times G_0} 
\end{align*}

对于空头套期保值组合，同样有：
\begin{align*}
    &\Delta \Pi = \Delta H - n \Delta G \\
    &\Rightarrow\quad\frac{\partial (\Delta \Pi)}{\partial (\Delta H)}  =  1 - n\times \frac{\partial (\Delta G)}{\partial (\Delta H)} = 0 \\ 
    &\Rightarrow \quad n = \frac{\partial(\Delta H)}{\partial(\Delta G)} = \frac{\partial r_H \times H_0}{\partial r_G \times G_0} 
\end{align*}

对多头套期保值或空头套期保值均有最优套保比率$n=\partial(\Delta H)/\partial(\Delta G)$，$r_H$和$r_G$为H与G在套期保值期间的收益率。n代表期货价格变动一个单位，现货价格变化多少，同时代表\textbf{每单位数量现货需要n单位数量期货进行对冲}。因现货与期货为线性关系，即套期保值后不需要随时间调整两者之间比率n，此为\textbf{静态套保（Static Hedge）}。与之相反的为\textbf{动态套保（Dynamic Hedge）}，需要不断随时间调整两者之间比率。

得知每单位数量现货需要n单位期货进行对冲之后，根据持有现货H头寸数量$Q_H$，可计算出需要多少份（手）的期货G合约进行对冲。即可求得最优套期保值（期货）合约份数N，使得期货总价值变动等于持有现货总价值变动。
\begin{align*}
    N = n \times \frac{Q_H}{Q_G} = \frac{\partial(\Delta H)\times Q_H}{\partial(\Delta G)\times Q_G} = \frac{\partial(r_H \times H_0 \times Q_H)}{\partial(r_G \times G_0 \times Q_G)} = \frac{\partial r_H \times V_H}{\partial r_G \times V_G}
\end{align*}

由$n \times Q_H$计算得到，对于现有头寸$Q_H$单位数量的现货，需要多少单位数量的期货进行对冲。再除以$Q_G$期货合约规模（乘数），计算得到需要N份（手）期货合约进行对冲。此时$V_H$为被套期保值的所持有现货资产总价值，而$V_G$则为每份期货合约价值（单位价格$\times$合约乘数）。\textbf{注意：n代表的是单位数量，而N为份数（手），为最小买卖单位。如螺纹钢期货报价单位为元/每吨，一份合约（手）包含10单位数量（吨）期货，即合约规模（乘数）为10。}

\subsection{最小方差套保（数量）比率}
当将风险定义为方差时，最优的套保比率可定义为，使套期保值组合收益$\Delta\Pi$方差最小的套期保值（数量）比例n，即为\textbf{最小方差套保比率}。$\sigma_\Pi^2$为套期保值组合收益的方差，对$n$求导，使一阶条件为零，二阶条件$d^2(\sigma_H^2)/dn^2=2\sigma_G^2>0$，有最小值。对于多头套保组合或空头套保组合，其最小方差套期保值比一般公式为：
\begin{align*}
    \sigma_{\Pi}^2 &= \sigma_H^2 + n^2\sigma_G^2 - 2n\sigma_{HG}\\
    &\Rightarrow \quad \frac{d\sigma_\Pi^2}{dn} = 2n\sigma_G^2 - 2\sigma_{HG} = 0 \\
    &\Rightarrow \quad n = \frac{\sigma_{HG}}{\sigma_G^2} =\rho_{HG} \frac{\sigma_H}{\sigma_G}
\end{align*}

其中$\sigma_H = \sigma_{\Delta H}$，$\sigma_G = \sigma_{\Delta G}$，$\sigma_{HG}$为$\Delta H$与$\Delta G$的协方差，$\rho_{HG}$为$\Delta H$与$\Delta G$的相关系数（$\rho_{XY} = Cov(X,Y)/\sigma_X\sigma_Y$）。我们可以进而推导出基于收益率的最小方差套期保值比率，首先：
\begin{align*}
    \rho_{HG} &= \frac{Cov(\Delta H,\Delta G)}{\sqrt{Var(\Delta H)} \sqrt{Var(\Delta G)}} \\
    &= \frac{Cov(r_H \times H_0,r_G \times G_0)}{\sqrt{Var(r_H \times H_0)} \sqrt{Var(r_G \times G_0)}}\\
    &= \frac{H_0 G_0 Cov(r_H,r_G))}{H_0 \sqrt{Var(r_H)} \times G_0 \sqrt{Var(r_G)}} \\
    &= \frac{Cov(r_H,r_G)}{\sqrt{Var(r_H)} \sqrt{Var(r_G)}} = \rho_{r_H r_G}
\end{align*}

其次：
\begin{equation*}
    \frac{\sigma_H}{\sigma_G} =  \frac{\sqrt{Var(r_H \times H_0)}}{\sqrt{Var(r_G \times G_0)}} = \frac{H_0 \sqrt{r_H}}{G_0 \sqrt{r_G}} = \frac{\sigma_{r_H} H_0}{\sigma_{r_G} G_0}
\end{equation*}

因此有：
\begin{equation*}
    n = \rho_{r_H r_G}\frac{\sigma_{r_H} H_0}{\sigma_{r_G} G_0}
\end{equation*}


\subsection{OLS估计}
可以观察$n = Cov(\Delta H,\Delta G)/Var(\Delta G)，$即为OLS回归中的系数$b$。则可用OLS回归，估计$b$：
\begin{equation*}
    \Delta H = a + b\Delta G + \varepsilon
\end{equation*}

需注意套保期限与回归中使用的$\Delta H$和$\Delta G$的期限应相同，即如果要锁定未来一个月的现货价格，需使用现货和期货的月价格变化进行回归。且调整后得到实际需要套期保值（期货）合约份数N为：
\begin{equation*}
    N =  b \frac{Q_H}{Q_G}
\end{equation*}

也可使用收益率进行OLS回归估计，且在时间极短时，百分比收益率$\Delta P/P$与对数收益率可视为相等。且对数收益率更符合平稳序列和正态分布的假设，在平稳假设的下对每日现货和期货的对数收益率进行回归：
\begin{equation*}
    r_H = a + b'r_G + \varepsilon
\end{equation*}

此时：
\begin{align*}
    b &= \frac{Cov(\Delta H,\Delta G)}{Var(\Delta G)} \\ 
    &= \frac{Cov(r_H \times H_0,r_G \times G_0)}{Var(r_g \times G_0)} \\
    &= \frac{H_0G_0 Cov(r_H,r_G)}{G_0^2 Var(r_G)} \\
    &= b'\frac{H_0}{G_0}
\end{align*}

对应需套期保值合约份数N（手）：
\begin{equation*}
    N =  b\frac{Q_H}{Q_G} = b'\frac{H_0 \times Q_H}{G_0 \times Q_G} = b'\frac{V_H}{V_G}
\end{equation*}

\subsection{风险降低百分比}
通过检验风险降低百分比，可以检验使用最小方差套期保值比率的套期保值效果。将最小方差套期保值比率$n = \rho_{HG}\frac{\sigma_{H}}{\sigma_{G}}$，带回套期保值组合方差$\sigma_{\Pi}^2 = \sigma_H^2 + n^2\sigma_G^2 - 2n\sigma_{HG}$中。可以得到：
\begin{equation*}
    e^* = \frac{\sigma_{H}^2 - \sigma_{\Delta \Pi}^2}{\sigma_{\Delta H}^2} = \rho_{HG}^2
    =\frac{Cov^2(\Delta H, \Delta G)}{Var(\Delta H)Var(\Delta G)}
    =\frac{Cov^2(r_H H_0, r_G G_0)}{Var(r_H H_0)Var(r_G G_0)}
    =\rho_{r_Hr_G}^2
\end{equation*}

而在一元线性回归中判别系数$R^2=\rho$，即回归效果越好，$R^2$越接近1，套期保值的效果也越好。

\end{document}
